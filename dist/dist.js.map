{"version":3,"sources":["../src/componentManager.js"],"names":["ComponentManager","permissions","onReady","sentMessages","messageQueue","initialPermissions","loggingEnabled","acceptsThemes","onReadyCallback","coallesedSaving","coallesedSavingDelay","messageHandler","event","mobileSource","console","log","data","origin","JSON","parse","handleMessage","document","addEventListener","window","payload","action","sessionKey","componentData","activateThemes","themes","original","originalMessage","filter","message","messageId","callback","length","requestPermissions","postMessage","environment","uuid","key","value","push","generateUUID","api","sentMessage","stringify","parent","type","width","height","bind","contentTypes","Array","isArray","content_types","items","item","jsonObjectForItem","associateItem","content_type","deleteItems","params","map","saveItems","updated_at","Date","saveBlock","pendingSave","clearTimeout","setTimeout","copy","Object","assign","children","AppDomain","content","appData","urls","deactivateAllCustomThemes","url","link","createElement","href","rel","media","className","getElementsByTagName","appendChild","elements","getElementsByClassName","forEach","call","element","disabled","parentNode","removeChild","crypto","msCrypto","buf","Uint32Array","getRandomValues","idx","replace","c","r","v","toString","d","getTime","performance","now","Math","random","floor","module","exports"],"mappings":"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","file":"dist.js","sourcesContent":["class ComponentManager {\n\n  constructor(permissions, onReady) {\n    this.sentMessages = [];\n    this.messageQueue = [];\n    this.initialPermissions = permissions;\n    this.loggingEnabled = false;\n    this.acceptsThemes = true;\n    this.onReadyCallback = onReady;\n\n    this.coallesedSaving = true;\n    this.coallesedSavingDelay = 250;\n\n    let messageHandler = (event, mobileSource) => {\n      if (this.loggingEnabled) { console.log(\"Components API Message received:\", event.data, \"mobile?\", mobileSource)}\n\n      // The first message will be the most reliable one, so we won't change it after any subsequent events,\n      // in case you receive an event from another window.\n      if(!this.origin) {\n        this.origin = event.origin;\n      }\n      this.mobileSource = mobileSource;\n      // If from mobile app, JSON needs to be used.\n      let data = mobileSource ? JSON.parse(event.data) : event.data;\n      this.handleMessage(data);\n    }\n\n    // Mobile (React Native) uses `document`, web/desktop uses `window`.addEventListener\n    // for postMessage API to work properly.\n\n    document.addEventListener(\"message\", function (event) {\n      messageHandler(event, true);\n    }, false);\n\n    window.addEventListener(\"message\", function (event) {\n      messageHandler(event, false);\n    }, false);\n  }\n\n  handleMessage(payload) {\n    if(payload.action === \"component-registered\") {\n      this.sessionKey = payload.sessionKey;\n      this.componentData = payload.componentData;\n      this.onReady(payload.data);\n\n      if(this.loggingEnabled) {\n        console.log(\"Component successfully registered with payload:\", payload);\n      }\n\n    } else if(payload.action === \"themes\") {\n      if(this.acceptsThemes) {\n        this.activateThemes(payload.data.themes);\n      }\n    }\n\n    else if(payload.original) {\n      // get callback from queue\n      var originalMessage = this.sentMessages.filter(function(message){\n        return message.messageId === payload.original.messageId;\n      })[0];\n\n      if(originalMessage.callback) {\n        originalMessage.callback(payload.data);\n      }\n    }\n  }\n\n  onReady(data) {\n    if(this.initialPermissions && this.initialPermissions.length > 0) {\n      this.requestPermissions(this.initialPermissions);\n    }\n\n    for(var message of this.messageQueue) {\n      this.postMessage(message.action, message.data, message.callback);\n    }\n\n    this.messageQueue = [];\n    this.environment = data.environment;\n    this.uuid = data.uuid;\n\n    if(this.onReadyCallback) {\n      this.onReadyCallback();\n    }\n  }\n\n  getSelfComponentUUID() {\n    return this.uuid;\n  }\n\n  isRunningInDesktopApplication() {\n    return this.environment === \"desktop\";\n  }\n\n  setComponentDataValueForKey(key, value) {\n    this.componentData[key] = value;\n    this.postMessage(\"set-component-data\", {componentData: this.componentData}, function(data){});\n  }\n\n  clearComponentData() {\n    this.componentData = {};\n    this.postMessage(\"set-component-data\", {componentData: this.componentData}, function(data){});\n  }\n\n  componentDataValueForKey(key) {\n    return this.componentData[key];\n  }\n\n  postMessage(action, data, callback) {\n    if(!this.sessionKey) {\n      this.messageQueue.push({\n        action: action,\n        data: data,\n        callback: callback\n      });\n      return;\n    }\n\n    var message = {\n      action: action,\n      data: data,\n      messageId: this.generateUUID(),\n      sessionKey: this.sessionKey,\n      api: \"component\"\n    }\n\n    var sentMessage = JSON.parse(JSON.stringify(message));\n    sentMessage.callback = callback;\n    this.sentMessages.push(sentMessage);\n\n    // Mobile (React Native) requires a string for the postMessage API.\n    if(this.mobileSource) {\n      message = JSON.stringify(message);\n    }\n\n    if(this.loggingEnabled) {\n      console.log(\"Posting message:\", message);\n    }\n\n    window.parent.postMessage(message, this.origin);\n  }\n\n  setSize(type, width, height) {\n    this.postMessage(\"set-size\", {type: type, width: width, height: height}, function(data){\n\n    })\n  }\n\n  requestPermissions(permissions, callback) {\n    this.postMessage(\"request-permissions\", {permissions: permissions}, function(data){\n      callback && callback();\n    }.bind(this));\n  }\n\n  streamItems(contentTypes, callback) {\n    if(!Array.isArray(contentTypes)) {\n      contentTypes = [contentTypes];\n    }\n    this.postMessage(\"stream-items\", {content_types: contentTypes}, function(data){\n      callback(data.items);\n    }.bind(this));\n  }\n\n  streamContextItem(callback) {\n    this.postMessage(\"stream-context-item\", null, (data) => {\n      var item = data.item;\n      /*\n        When an item is saved via saveItem, its updated_at value is set client side to the current date.\n        If we make a change locally, then for whatever reason receive an item via streamItems/streamContextItem,\n        we want to ignore that change if it was made prior to the latest change we've made.\n\n        Update 1/22/18: However, if a user is restoring a note from version history, this change\n        will not pass through this filter and will thus be ignored. Because the client now handles\n        this case with isMetadataUpdate, we no longer need the below.\n      */\n      // if(this.streamedContextItem && this.streamedContextItem.uuid == item.uuid\n      //   && this.streamedContextItem.updated_at > item.updated_at) {\n      //   return;\n      // }\n      // this.streamedContextItem = item;\n      callback(item);\n    });\n  }\n\n  selectItem(item) {\n    this.postMessage(\"select-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  createItem(item, callback) {\n    this.postMessage(\"create-item\", {item: this.jsonObjectForItem(item)}, function(data){\n      var item = data.item;\n      this.associateItem(item);\n      callback && callback(item);\n    }.bind(this));\n  }\n\n  associateItem(item) {\n    this.postMessage(\"associate-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  deassociateItem(item) {\n    this.postMessage(\"deassociate-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  clearSelection() {\n    this.postMessage(\"clear-selection\", {content_type: \"Tag\"});\n  }\n\n  deleteItem(item) {\n    this.deleteItems([item]);\n  }\n\n  deleteItems(items) {\n    var params = {\n      items: items.map(function(item){\n        return this.jsonObjectForItem(item);\n      }.bind(this))\n    };\n    this.postMessage(\"delete-items\", params);\n  }\n\n  sendCustomEvent(action, data, callback) {\n    this.postMessage(action, data, function(data){\n      callback && callback(data);\n    }.bind(this));\n  }\n\n  saveItem(item, callback) {\n    this.saveItems([item], callback);\n  }\n\n  saveItems(items, callback) {\n    items = items.map(function(item) {\n      item.updated_at = new Date();\n      return this.jsonObjectForItem(item);\n    }.bind(this));\n\n    let saveBlock = () => {\n      this.postMessage(\"save-items\", {items: items}, function(data){\n        callback && callback();\n      });\n    }\n\n    /*\n      Coallesed saving prevents saves from being made after every keystroke, and instead\n      waits coallesedSavingDelay before performing action. For example, if a user types a keystroke, and the clienet calls saveItem,\n      a 250ms delay will begin. If they type another keystroke within 250ms, the previously pending\n      save will be cancelled, and another 250ms delay occurs. If ater 250ms the pending delay is not cleared by a future call,\n      the save will finally trigger.\n\n      Note: it's important to modify saving items updated_at immediately and not after delay. If you modify after delay,\n      a delayed sync could just be wrapping up, and will send back old data and replace what the user has typed.\n    */\n    if(this.coallesedSaving == true) {\n      if(this.pendingSave) {\n        clearTimeout(this.pendingSave);\n      }\n\n      this.pendingSave = setTimeout(() => {\n        saveBlock();\n      }, this.coallesedSavingDelay);\n    }\n  }\n\n  jsonObjectForItem(item) {\n    var copy = Object.assign({}, item);\n    copy.children = null;\n    copy.parent = null;\n    return copy;\n  }\n\n  getItemAppDataValue(item, key) {\n    let AppDomain = \"org.standardnotes.sn\";\n    var data = item.content.appData && item.content.appData[AppDomain];\n    if(data) {\n      return data[key];\n    } else {\n      return null;\n    }\n  }\n\n  /* Themes */\n\n  activateThemes(urls) {\n    this.deactivateAllCustomThemes();\n\n    if(this.loggingEnabled) {\n      console.log(\"Activating themes:\", urls);\n    }\n\n    if(!urls) {\n      return;\n    }\n\n    for(var url of urls) {\n      if(!url) {\n        continue;\n      }\n\n      var link = document.createElement(\"link\");\n      link.href = url;\n      link.type = \"text/css\";\n      link.rel = \"stylesheet\";\n      link.media = \"screen,print\";\n      link.className = \"custom-theme\";\n      document.getElementsByTagName(\"head\")[0].appendChild(link);\n    }\n  }\n\n  deactivateAllCustomThemes() {\n    var elements = document.getElementsByClassName(\"custom-theme\");\n\n    [].forEach.call(elements, function (element) {\n      if(element) {\n        element.disabled = true;\n        element.parentNode.removeChild(element);\n      }\n    });\n  }\n\n\n  /* Utilities */\n\n\n  generateUUID() {\n    var crypto = window.crypto || window.msCrypto;\n    if(crypto) {\n      var buf = new Uint32Array(4);\n      crypto.getRandomValues(buf);\n      var idx = -1;\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n          idx++;\n          var r = (buf[idx>>3] >> ((idx%8)*4))&15;\n          var v = c == 'x' ? r : (r&0x3|0x8);\n          return v.toString(16);\n      });\n    } else {\n      var d = new Date().getTime();\n      if(window.performance && typeof window.performance.now === \"function\"){\n        d += performance.now(); //use high-precision timer if available\n      }\n      var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = (d + Math.random()*16)%16 | 0;\n        d = Math.floor(d/16);\n        return (c=='x' ? r : (r&0x3|0x8)).toString(16);\n      });\n      return uuid;\n    }\n  }\n}\n\n\nif(typeof module != \"undefined\" && typeof module.exports != \"undefined\") {\n  module.exports = ComponentManager;\n}\n\nif(window) {\n  window.ComponentManager = ComponentManager;\n}\n"]}