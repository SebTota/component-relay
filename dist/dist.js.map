{"version":3,"sources":["../src/componentManager.js"],"names":["ComponentManager","constructor","permissions","onReady","sentMessages","messageQueue","loggingEnabled","onReadyCallback","window","addEventListener","event","console","log","data","handleMessage","bind","payload","action","sessionKey","componentData","activateThemes","themes","original","originalMessage","filter","message","messageId","callback","postMessage","setComponentDataValueForKey","key","value","clearComponentData","componentDataValueForKey","push","generateUUID","api","sentMessage","JSON","parse","stringify","parent","setSize","type","width","height","streamItems","content_types","tags","items","streamContextItem","item","selectItem","jsonObjectForItem","createItem","associateItem","deassociateItem","clearSelection","content_type","deleteItem","deleteItems","params","map","saveItem","saveItems","copy","Object","assign","children","urls","deactivateAllCustomThemes","url","link","document","createElement","href","rel","media","className","getElementsByTagName","appendChild","elements","getElementsByClassName","forEach","call","element","disabled","parentNode","removeChild","crypto","msCrypto","buf","Uint32Array","getRandomValues","idx","replace","c","r","v","toString","d","Date","getTime","performance","now","uuid","Math","random","floor"],"mappings":"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","file":"dist.js","sourcesContent":["class ComponentManager {\n\n  constructor(permissions, onReady) {\n    this.sentMessages = [];\n    this.messageQueue = [];\n    this.permissions = permissions;\n    this.loggingEnabled = false;\n    this.onReadyCallback = onReady;\n\n    window.addEventListener(\"message\", function(event){\n      if(this.loggingEnabled) {\n        console.log(\"Components API Message received:\", event.data);\n      }\n      this.handleMessage(event.data);\n    }.bind(this), false);\n  }\n\n  handleMessage(payload) {\n    if(payload.action === \"component-registered\") {\n      this.sessionKey = payload.sessionKey;\n      this.componentData = payload.componentData;\n      this.onReady();\n\n      if(this.loggingEnabled) {\n        console.log(\"Component successfully registered with payload:\", payload);\n      }\n\n    } else if(payload.action === \"themes\") {\n      this.activateThemes(payload.data.themes);\n    }\n\n    else if(payload.original) {\n      // get callback from queue\n      var originalMessage = this.sentMessages.filter(function(message){\n        return message.messageId === payload.original.messageId;\n      })[0];\n\n      if(originalMessage.callback) {\n        originalMessage.callback(payload.data);\n      }\n    }\n  }\n\n  onReady() {\n    for(var message of this.messageQueue) {\n      this.postMessage(message.action, message.data, message.callback);\n    }\n    this.messageQueue = [];\n\n    if(this.onReadyCallback) {\n      this.onReadyCallback();\n    }\n  }\n\n  setComponentDataValueForKey(key, value) {\n    this.componentData[key] = value;\n    this.postMessage(\"set-component-data\", {componentData: this.componentData}, function(data){});\n  }\n\n  clearComponentData() {\n    this.componentData = {};\n    this.postMessage(\"set-component-data\", {componentData: this.componentData}, function(data){});\n  }\n\n  componentDataValueForKey(key) {\n    return this.componentData[key];\n  }\n\n  postMessage(action, data, callback) {\n    if(!this.sessionKey) {\n      this.messageQueue.push({\n        action: action,\n        data: data,\n        callback: callback\n      });\n      return;\n    }\n\n    var message = {\n      action: action,\n      data: data,\n      messageId: this.generateUUID(),\n      sessionKey: this.sessionKey,\n      permissions: this.permissions,\n      api: \"component\"\n    }\n\n    var sentMessage = JSON.parse(JSON.stringify(message));\n    sentMessage.callback = callback;\n    this.sentMessages.push(sentMessage);\n\n    if(this.loggingEnabled) {\n      console.log(\"Posting message:\", message);\n    }\n\n    window.parent.postMessage(message, '*');\n  }\n\n  setSize(type, width, height) {\n    this.postMessage(\"set-size\", {type: type, width: width, height: height}, function(data){\n\n    })\n  }\n\n  streamItems(callback) {\n    this.postMessage(\"stream-items\", {content_types: [\"Tag\"]}, function(data){\n      var tags = data.items;\n      callback(tags);\n    }.bind(this));\n  }\n\n  streamContextItem(callback) {\n    this.postMessage(\"stream-context-item\", null, function(data){\n      var item = data.item;\n      callback(item);\n    }.bind(this));\n  }\n\n  selectItem(item) {\n    this.postMessage(\"select-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  createItem(item) {\n    this.postMessage(\"create-item\", {item: this.jsonObjectForItem(item)}, function(data){\n      var item = data.item;\n      this.associateItem(item);\n    }.bind(this));\n  }\n\n  associateItem(item) {\n    this.postMessage(\"associate-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  deassociateItem(item) {\n    this.postMessage(\"deassociate-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  clearSelection() {\n    this.postMessage(\"clear-selection\", {content_type: \"Tag\"});\n  }\n\n  deleteItem(item) {\n    this.deleteItems([item]);\n  }\n\n  deleteItems(items) {\n    var params = {\n      items: items.map(function(item){\n        return this.jsonObjectForItem(item);\n      }.bind(this))\n    };\n    this.postMessage(\"delete-items\", params);\n  }\n\n  saveItem(item) {\n    this.saveItems([item]);\n  }\n\n  saveItems(items) {\n    items = items.map(function(item) {\n      return this.jsonObjectForItem(item);\n    }.bind(this));\n\n    this.postMessage(\"save-items\", {items: items}, function(data){\n\n    });\n  }\n\n  jsonObjectForItem(item) {\n    var copy = Object.assign({}, item);\n    copy.children = null;\n    copy.parent = null;\n    return copy;\n  }\n\n\n  /* Themes */\n\n  activateThemes(urls) {\n    this.deactivateAllCustomThemes();\n\n    if(this.loggingEnabled) {\n      console.log(\"Activating themes:\", urls);\n    }\n\n    if(!urls) {\n      return;\n    }\n\n    for(var url of urls) {\n      if(!url) {\n        continue;\n      }\n\n      var link = document.createElement(\"link\");\n      link.href = url;\n      link.type = \"text/css\";\n      link.rel = \"stylesheet\";\n      link.media = \"screen,print\";\n      link.className = \"custom-theme\";\n      document.getElementsByTagName(\"head\")[0].appendChild(link);\n    }\n  }\n\n  deactivateAllCustomThemes() {\n    var elements = document.getElementsByClassName(\"custom-theme\");\n\n    [].forEach.call(elements, function (element) {\n      if(element) {\n        element.disabled = true;\n        element.parentNode.removeChild(element);\n      }\n    });\n  }\n\n\n  /* Utilities */\n\n\n  generateUUID() {\n    var crypto = window.crypto || window.msCrypto;\n    if(crypto) {\n      var buf = new Uint32Array(4);\n      crypto.getRandomValues(buf);\n      var idx = -1;\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n          idx++;\n          var r = (buf[idx>>3] >> ((idx%8)*4))&15;\n          var v = c == 'x' ? r : (r&0x3|0x8);\n          return v.toString(16);\n      });\n    } else {\n      var d = new Date().getTime();\n      if(window.performance && typeof window.performance.now === \"function\"){\n        d += performance.now(); //use high-precision timer if available\n      }\n      var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = (d + Math.random()*16)%16 | 0;\n        d = Math.floor(d/16);\n        return (c=='x' ? r : (r&0x3|0x8)).toString(16);\n      });\n      return uuid;\n    }\n  }\n}\n\nwindow.ComponentManager = ComponentManager;\n"]}