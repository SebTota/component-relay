{"version":3,"sources":["../src/componentManager.js"],"names":["ComponentManager","permissions","onReady","sentMessages","messageQueue","initialPermissions","loggingEnabled","acceptsThemes","onReadyCallback","coallesedSaving","coallesedSavingDelay","window","addEventListener","event","console","log","data","handleMessage","bind","payload","action","sessionKey","componentData","activateThemes","themes","original","originalMessage","filter","message","messageId","callback","length","requestPermissions","postMessage","environment","key","value","push","generateUUID","api","sentMessage","JSON","parse","stringify","parent","type","width","height","contentTypes","Array","isArray","content_types","items","item","streamedContextItem","uuid","updated_at","jsonObjectForItem","associateItem","content_type","deleteItems","params","map","saveItems","Date","saveBlock","pendingSave","clearTimeout","setTimeout","copy","Object","assign","children","urls","deactivateAllCustomThemes","url","link","document","createElement","href","rel","media","className","getElementsByTagName","appendChild","elements","getElementsByClassName","forEach","call","element","disabled","parentNode","removeChild","crypto","msCrypto","buf","Uint32Array","getRandomValues","idx","replace","c","r","v","toString","d","getTime","performance","now","Math","random","floor","module","exports"],"mappings":"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","file":"dist.js","sourcesContent":["class ComponentManager {\n\n  constructor(permissions, onReady) {\n    this.sentMessages = [];\n    this.messageQueue = [];\n    this.initialPermissions = permissions;\n    this.loggingEnabled = false;\n    this.acceptsThemes = true;\n    this.onReadyCallback = onReady;\n\n    this.coallesedSaving = true;\n    this.coallesedSavingDelay = 250;\n\n    window.addEventListener(\"message\", function(event){\n      if(this.loggingEnabled) {\n        console.log(\"Components API Message received:\", event.data);\n      }\n      this.handleMessage(event.data);\n    }.bind(this), false);\n  }\n\n  handleMessage(payload) {\n    if(payload.action === \"component-registered\") {\n      this.sessionKey = payload.sessionKey;\n      this.componentData = payload.componentData;\n      this.onReady(payload.data);\n\n      if(this.loggingEnabled) {\n        console.log(\"Component successfully registered with payload:\", payload);\n      }\n\n    } else if(payload.action === \"themes\") {\n      if(this.acceptsThemes) {\n        this.activateThemes(payload.data.themes);\n      }\n    }\n\n    else if(payload.original) {\n      // get callback from queue\n      var originalMessage = this.sentMessages.filter(function(message){\n        return message.messageId === payload.original.messageId;\n      })[0];\n\n      if(originalMessage.callback) {\n        originalMessage.callback(payload.data);\n      }\n    }\n  }\n\n  onReady(data) {\n    if(this.initialPermissions && this.initialPermissions.length > 0) {\n      this.requestPermissions(this.initialPermissions);\n    }\n\n    for(var message of this.messageQueue) {\n      this.postMessage(message.action, message.data, message.callback);\n    }\n    this.messageQueue = [];\n    this.environment = data.environment;\n\n    if(this.onReadyCallback) {\n      this.onReadyCallback();\n    }\n  }\n\n  isRunningInDesktopApplication() {\n    return this.environment === \"desktop\";\n  }\n\n  setComponentDataValueForKey(key, value) {\n    this.componentData[key] = value;\n    this.postMessage(\"set-component-data\", {componentData: this.componentData}, function(data){});\n  }\n\n  clearComponentData() {\n    this.componentData = {};\n    this.postMessage(\"set-component-data\", {componentData: this.componentData}, function(data){});\n  }\n\n  componentDataValueForKey(key) {\n    return this.componentData[key];\n  }\n\n  postMessage(action, data, callback) {\n    if(!this.sessionKey) {\n      this.messageQueue.push({\n        action: action,\n        data: data,\n        callback: callback\n      });\n      return;\n    }\n\n    var message = {\n      action: action,\n      data: data,\n      messageId: this.generateUUID(),\n      sessionKey: this.sessionKey,\n      api: \"component\"\n    }\n\n    var sentMessage = JSON.parse(JSON.stringify(message));\n    sentMessage.callback = callback;\n    this.sentMessages.push(sentMessage);\n\n    if(this.loggingEnabled) {\n      console.log(\"Posting message:\", message);\n    }\n\n    window.parent.postMessage(message, '*');\n  }\n\n  setSize(type, width, height) {\n    this.postMessage(\"set-size\", {type: type, width: width, height: height}, function(data){\n\n    })\n  }\n\n  requestPermissions(permissions, callback) {\n    this.postMessage(\"request-permissions\", {permissions: permissions}, function(data){\n      callback && callback();\n    }.bind(this));\n  }\n\n  streamItems(contentTypes, callback) {\n    if(!Array.isArray(contentTypes)) {\n      contentTypes = [contentTypes];\n    }\n    this.postMessage(\"stream-items\", {content_types: contentTypes}, function(data){\n      callback(data.items);\n    }.bind(this));\n  }\n\n  streamContextItem(callback) {\n    this.postMessage(\"stream-context-item\", null, (data) => {\n      var item = data.item;\n      /*\n        When an item is saved via saveItem, its updated_at value is set client side to the current date.\n        If we make a change locally, then for whatever reason receive an item via streamItems/streamContextItem,\n        we want to ignore that change if it was made prior to the latest change we've made.\n      */\n      if(this.streamedContextItem && this.streamedContextItem.uuid == item.uuid\n        && this.streamedContextItem.updated_at > item.updated_at) {\n        return;\n      }\n      this.streamedContextItem = item;\n      callback(item);\n    });\n  }\n\n  selectItem(item) {\n    this.postMessage(\"select-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  createItem(item, callback) {\n    this.postMessage(\"create-item\", {item: this.jsonObjectForItem(item)}, function(data){\n      var item = data.item;\n      this.associateItem(item);\n      callback && callback(item);\n    }.bind(this));\n  }\n\n  associateItem(item) {\n    this.postMessage(\"associate-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  deassociateItem(item) {\n    this.postMessage(\"deassociate-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  clearSelection() {\n    this.postMessage(\"clear-selection\", {content_type: \"Tag\"});\n  }\n\n  deleteItem(item) {\n    this.deleteItems([item]);\n  }\n\n  deleteItems(items) {\n    var params = {\n      items: items.map(function(item){\n        return this.jsonObjectForItem(item);\n      }.bind(this))\n    };\n    this.postMessage(\"delete-items\", params);\n  }\n\n  sendCustomEvent(action, data, callback) {\n    this.postMessage(action, data, function(data){\n      callback && callback(data);\n    }.bind(this));\n  }\n\n  saveItem(item, callback) {\n    this.saveItems([item], callback);\n  }\n\n  saveItems(items, callback) {\n    items = items.map(function(item) {\n      item.updated_at = new Date();\n      return this.jsonObjectForItem(item);\n    }.bind(this));\n\n    let saveBlock = () => {\n      this.postMessage(\"save-items\", {items: items}, function(data){\n        callback && callback();\n      });\n    }\n\n    /*\n        Coallesed saving prevents saves from being made after every keystroke, and instead\n        waits coallesedSavingDelay before performing action. For example, if a user types a keystroke, and the clienet calls saveItem,\n        a 250ms delay will begin. If they type another keystroke within 250ms, the previously pending\n        save will be cancelled, and another 250ms delay occurs. If ater 250ms the pending delay is not cleared by a future call,\n        the save will finally trigger.\n\n        Note: it's important to modify saving items updated_at immediately and not after delay. If you modify after delay,\n        a delayed sync could just be wrapping up, and will send back old data and replace what the user has typed.\n    */\n    if(this.coallesedSaving == true) {\n      if(this.pendingSave) {\n        clearTimeout(this.pendingSave);\n      }\n\n      this.pendingSave = setTimeout(() => {\n        saveBlock();\n      }, this.coallesedSavingDelay);\n    }\n  }\n\n  jsonObjectForItem(item) {\n    var copy = Object.assign({}, item);\n    copy.children = null;\n    copy.parent = null;\n    return copy;\n  }\n\n\n  /* Themes */\n\n  activateThemes(urls) {\n    this.deactivateAllCustomThemes();\n\n    if(this.loggingEnabled) {\n      console.log(\"Activating themes:\", urls);\n    }\n\n    if(!urls) {\n      return;\n    }\n\n    for(var url of urls) {\n      if(!url) {\n        continue;\n      }\n\n      var link = document.createElement(\"link\");\n      link.href = url;\n      link.type = \"text/css\";\n      link.rel = \"stylesheet\";\n      link.media = \"screen,print\";\n      link.className = \"custom-theme\";\n      document.getElementsByTagName(\"head\")[0].appendChild(link);\n    }\n  }\n\n  deactivateAllCustomThemes() {\n    var elements = document.getElementsByClassName(\"custom-theme\");\n\n    [].forEach.call(elements, function (element) {\n      if(element) {\n        element.disabled = true;\n        element.parentNode.removeChild(element);\n      }\n    });\n  }\n\n\n  /* Utilities */\n\n\n  generateUUID() {\n    var crypto = window.crypto || window.msCrypto;\n    if(crypto) {\n      var buf = new Uint32Array(4);\n      crypto.getRandomValues(buf);\n      var idx = -1;\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n          idx++;\n          var r = (buf[idx>>3] >> ((idx%8)*4))&15;\n          var v = c == 'x' ? r : (r&0x3|0x8);\n          return v.toString(16);\n      });\n    } else {\n      var d = new Date().getTime();\n      if(window.performance && typeof window.performance.now === \"function\"){\n        d += performance.now(); //use high-precision timer if available\n      }\n      var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = (d + Math.random()*16)%16 | 0;\n        d = Math.floor(d/16);\n        return (c=='x' ? r : (r&0x3|0x8)).toString(16);\n      });\n      return uuid;\n    }\n  }\n}\n\n\nif(typeof module != \"undefined\" && typeof module.exports != \"undefined\") {\n  module.exports = ComponentManager;\n}\n\nif(window) {\n  window.ComponentManager = ComponentManager;\n}\n"]}