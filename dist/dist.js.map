{"version":3,"sources":["../src/componentManager.js"],"names":["ComponentManager","constructor","loggingEnabled","sentMessages","messageQueue","window","addEventListener","event","console","log","data","handleMessage","bind","payload","action","sessionKey","onReady","activateThemes","themes","original","originalMessage","filter","message","messageId","callback","postMessage","push","generateUUID","api","sentMessage","JSON","parse","stringify","parent","setSize","type","width","height","streamItems","content_types","tags","items","streamContextItem","item","selectItem","jsonObjectForItem","createItem","associateItem","deassociateItem","clearSelection","content_type","deleteItem","saveItem","saveItems","map","copy","Object","assign","children","urls","deactivateAllCustomThemes","url","link","document","createElement","href","rel","media","className","getElementsByTagName","appendChild","elements","getElementsByClassName","forEach","call","element","disabled","parentNode","removeChild","crypto","msCrypto","buf","Uint32Array","getRandomValues","idx","replace","c","r","v","toString","d","Date","getTime","performance","now","uuid","Math","random","floor"],"mappings":"AAAA,MAAMA,gBAAN,CAAuB;;AAErBC,cAAYC,cAAZ,EAA4B;AAC1B,SAAKC,YAAL,GAAoB,EAApB;AACA,SAAKC,YAAL,GAAoB,EAApB;;AAEAC,WAAOC,gBAAP,CAAwB,SAAxB,EAAmC,UAASC,KAAT,EAAe;AAChD,UAAGL,cAAH,EAAmB;AACjBM,gBAAQC,GAAR,CAAY,kCAAZ,EAAgDF,MAAMG,IAAtD;AACD;AACD,WAAKC,aAAL,CAAmBJ,MAAMG,IAAzB;AACD,KALkC,CAKjCE,IALiC,CAK5B,IAL4B,CAAnC,EAKc,KALd;AAMD;;AAEDD,gBAAcE,OAAd,EAAuB;AACrB,QAAGA,QAAQC,MAAR,KAAmB,sBAAtB,EAA8C;AAC5C,WAAKC,UAAL,GAAkBF,QAAQE,UAA1B;AACA,WAAKC,OAAL;AACD,KAHD,MAGO,IAAGH,QAAQC,MAAR,KAAmB,QAAtB,EAAgC;AACrC,WAAKG,cAAL,CAAoBJ,QAAQH,IAAR,CAAaQ,MAAjC;AACD,KAFM,MAIF,IAAGL,QAAQM,QAAX,EAAqB;AACxB;AACA,UAAIC,kBAAkB,KAAKjB,YAAL,CAAkBkB,MAAlB,CAAyB,UAASC,OAAT,EAAiB;AAC9D,eAAOA,QAAQC,SAAR,KAAsBV,QAAQM,QAAR,CAAiBI,SAA9C;AACD,OAFqB,EAEnB,CAFmB,CAAtB;;AAIA,UAAGH,gBAAgBI,QAAnB,EAA6B;AAC3BJ,wBAAgBI,QAAhB,CAAyBX,QAAQH,IAAjC;AACD;AACF;AACF;;AAEDM,YAAU;AACR,SAAI,IAAIM,OAAR,IAAmB,KAAKlB,YAAxB,EAAsC;AACpC,WAAKqB,WAAL,CAAiBH,QAAQR,MAAzB,EAAiCQ,QAAQZ,IAAzC,EAA+CY,QAAQE,QAAvD;AACD;AACD,SAAKpB,YAAL,GAAoB,EAApB;AACD;;AAEDqB,cAAYX,MAAZ,EAAoBJ,IAApB,EAA0Bc,QAA1B,EAAoC;AAClC,QAAG,CAAC,KAAKT,UAAT,EAAqB;AACnB,WAAKX,YAAL,CAAkBsB,IAAlB,CAAuB;AACrBZ,gBAAQA,MADa;AAErBJ,cAAMA,IAFe;AAGrBc,kBAAUA;AAHW,OAAvB;AAKA;AACD;;AAED,QAAIF,UAAU;AACZR,cAAQA,MADI;AAEZJ,YAAMA,IAFM;AAGZa,iBAAW,KAAKI,YAAL,EAHC;AAIZZ,kBAAY,KAAKA,UAJL;AAKZa,WAAK;AALO,KAAd;;AAQA,QAAIC,cAAcC,KAAKC,KAAL,CAAWD,KAAKE,SAAL,CAAeV,OAAf,CAAX,CAAlB;AACAO,gBAAYL,QAAZ,GAAuBA,QAAvB;AACA,SAAKrB,YAAL,CAAkBuB,IAAlB,CAAuBG,WAAvB;;AAEAxB,WAAO4B,MAAP,CAAcR,WAAd,CAA0BH,OAA1B,EAAmC,GAAnC;AACD;;AAEDY,UAAQC,IAAR,EAAcC,KAAd,EAAqBC,MAArB,EAA6B;AAC3B,SAAKZ,WAAL,CAAiB,UAAjB,EAA6B,EAACU,MAAMA,IAAP,EAAaC,OAAOA,KAApB,EAA2BC,QAAQA,MAAnC,EAA7B,EAAyE,UAAS3B,IAAT,EAAc,CAEtF,CAFD;AAGD;;AAED4B,cAAYd,QAAZ,EAAsB;AACpB,SAAKC,WAAL,CAAiB,cAAjB,EAAiC,EAACc,eAAe,CAAC,KAAD,CAAhB,EAAjC,EAA2D,UAAS7B,IAAT,EAAc;AACvE,UAAI8B,OAAO9B,KAAK+B,KAAhB;AACAjB,eAASgB,IAAT;AACD,KAH0D,CAGzD5B,IAHyD,CAGpD,IAHoD,CAA3D;AAID;;AAED8B,oBAAkBlB,QAAlB,EAA4B;AAC1B,SAAKC,WAAL,CAAiB,qBAAjB,EAAwC,IAAxC,EAA8C,UAASf,IAAT,EAAc;AAC1D,UAAIiC,OAAOjC,KAAKiC,IAAhB;AACAnB,eAASmB,IAAT;AACD,KAH6C,CAG5C/B,IAH4C,CAGvC,IAHuC,CAA9C;AAID;;AAEDgC,aAAWD,IAAX,EAAiB;AACf,SAAKlB,WAAL,CAAiB,aAAjB,EAAgC,EAACkB,MAAM,KAAKE,iBAAL,CAAuBF,IAAvB,CAAP,EAAhC;AACD;;AAEDG,aAAWH,IAAX,EAAiB;AACf,SAAKlB,WAAL,CAAiB,aAAjB,EAAgC,EAACkB,MAAM,KAAKE,iBAAL,CAAuBF,IAAvB,CAAP,EAAhC,EAAsE,UAASjC,IAAT,EAAc;AAClF,UAAIiC,OAAOjC,KAAKiC,IAAhB;AACA,WAAKI,aAAL,CAAmBJ,IAAnB;AACD,KAHqE,CAGpE/B,IAHoE,CAG/D,IAH+D,CAAtE;AAID;;AAEDmC,gBAAcJ,IAAd,EAAoB;AAClB,SAAKlB,WAAL,CAAiB,gBAAjB,EAAmC,EAACkB,MAAM,KAAKE,iBAAL,CAAuBF,IAAvB,CAAP,EAAnC;AACD;;AAEDK,kBAAgBL,IAAhB,EAAsB;AACpB,SAAKlB,WAAL,CAAiB,kBAAjB,EAAqC,EAACkB,MAAM,KAAKE,iBAAL,CAAuBF,IAAvB,CAAP,EAArC;AACD;;AAEDM,mBAAiB;AACf,SAAKxB,WAAL,CAAiB,iBAAjB,EAAoC,EAACyB,cAAc,KAAf,EAApC;AACD;;AAEDC,aAAWR,IAAX,EAAiB;AACf,SAAKlB,WAAL,CAAiB,aAAjB,EAAgC,EAACkB,MAAM,KAAKE,iBAAL,CAAuBF,IAAvB,CAAP,EAAhC;AACD;;AAGDS,WAAST,IAAT,EAAe;AACb,SAAKU,SAAL,CAAeV,IAAf;AACD;;AAEDU,YAAUZ,KAAV,EAAiB;AACfA,YAAQA,MAAMa,GAAN,CAAU,UAASX,IAAT,EAAe;AAC/B,aAAO,KAAKE,iBAAL,CAAuBF,IAAvB,CAAP;AACD,KAFiB,CAEhB/B,IAFgB,CAEX,IAFW,CAAV,CAAR;;AAIA,SAAKa,WAAL,CAAiB,YAAjB,EAA+B,EAACgB,OAAOA,KAAR,EAA/B,EAA+C,UAAS/B,IAAT,EAAc,CAE5D,CAFD;AAGD;;AAEDmC,oBAAkBF,IAAlB,EAAwB;AACtB,QAAIY,OAAOC,OAAOC,MAAP,CAAc,EAAd,EAAkBd,IAAlB,CAAX;AACAY,SAAKG,QAAL,GAAgB,IAAhB;AACAH,SAAKtB,MAAL,GAAc,IAAd;AACA,WAAOsB,IAAP;AACD;;AAGD;;AAEAtC,iBAAe0C,IAAf,EAAqB;AACnB,SAAKC,yBAAL;;AAEApD,YAAQC,GAAR,CAAY,oBAAZ,EAAkCkD,IAAlC;;AAEA,QAAG,CAACA,IAAJ,EAAU;AACR;AACD;;AAED,SAAI,IAAIE,GAAR,IAAeF,IAAf,EAAqB;AACnB,UAAG,CAACE,GAAJ,EAAS;AACP;AACD;;AAED,UAAIC,OAAOC,SAASC,aAAT,CAAuB,MAAvB,CAAX;AACAF,WAAKG,IAAL,GAAYJ,GAAZ;AACAC,WAAK3B,IAAL,GAAY,UAAZ;AACA2B,WAAKI,GAAL,GAAW,YAAX;AACAJ,WAAKK,KAAL,GAAa,cAAb;AACAL,WAAKM,SAAL,GAAiB,cAAjB;AACAL,eAASM,oBAAT,CAA8B,MAA9B,EAAsC,CAAtC,EAAyCC,WAAzC,CAAqDR,IAArD;AACD;AACF;;AAEDF,8BAA4B;AAC1B,QAAIW,WAAWR,SAASS,sBAAT,CAAgC,cAAhC,CAAf;;AAEA,OAAGC,OAAH,CAAWC,IAAX,CAAgBH,QAAhB,EAA0B,UAAUI,OAAV,EAAmB;AAC3C,UAAGA,OAAH,EAAY;AACVA,gBAAQC,QAAR,GAAmB,IAAnB;AACAD,gBAAQE,UAAR,CAAmBC,WAAnB,CAA+BH,OAA/B;AACD;AACF,KALD;AAMD;;AAGD;;AAGAhD,iBAAe;AACb,QAAIoD,SAAS1E,OAAO0E,MAAP,IAAiB1E,OAAO2E,QAArC;AACA,QAAGD,MAAH,EAAW;AACT,UAAIE,MAAM,IAAIC,WAAJ,CAAgB,CAAhB,CAAV;AACAH,aAAOI,eAAP,CAAuBF,GAAvB;AACA,UAAIG,MAAM,CAAC,CAAX;AACA,aAAO,uCAAuCC,OAAvC,CAA+C,OAA/C,EAAwD,UAASC,CAAT,EAAY;AACvEF;AACA,YAAIG,IAAKN,IAAIG,OAAK,CAAT,KAAiBA,MAAI,CAAL,GAAQ,CAAzB,GAA6B,EAArC;AACA,YAAII,IAAIF,KAAK,GAAL,GAAWC,CAAX,GAAgBA,IAAE,GAAF,GAAM,GAA9B;AACA,eAAOC,EAAEC,QAAF,CAAW,EAAX,CAAP;AACH,OALM,CAAP;AAMD,KAVD,MAUO;AACL,UAAIC,IAAI,IAAIC,IAAJ,GAAWC,OAAX,EAAR;AACA,UAAGvF,OAAOwF,WAAP,IAAsB,OAAOxF,OAAOwF,WAAP,CAAmBC,GAA1B,KAAkC,UAA3D,EAAsE;AACpEJ,aAAKG,YAAYC,GAAZ,EAAL,CADoE,CAC5C;AACzB;AACD,UAAIC,OAAO,uCAAuCV,OAAvC,CAA+C,OAA/C,EAAwD,UAASC,CAAT,EAAY;AAC7E,YAAIC,IAAI,CAACG,IAAIM,KAAKC,MAAL,KAAc,EAAnB,IAAuB,EAAvB,GAA4B,CAApC;AACAP,YAAIM,KAAKE,KAAL,CAAWR,IAAE,EAAb,CAAJ;AACA,eAAO,CAACJ,KAAG,GAAH,GAASC,CAAT,GAAcA,IAAE,GAAF,GAAM,GAArB,EAA2BE,QAA3B,CAAoC,EAApC,CAAP;AACD,OAJU,CAAX;AAKA,aAAOM,IAAP;AACD;AACF;AAzMoB;;AA4MvB1F,OAAOL,gBAAP,GAA0BA,gBAA1B","file":"dist.js","sourcesContent":["class ComponentManager {\n\n  constructor(loggingEnabled) {\n    this.sentMessages = [];\n    this.messageQueue = [];\n\n    window.addEventListener(\"message\", function(event){\n      if(loggingEnabled) {\n        console.log(\"Components API Message received:\", event.data);\n      }\n      this.handleMessage(event.data);\n    }.bind(this), false);\n  }\n\n  handleMessage(payload) {\n    if(payload.action === \"component-registered\") {\n      this.sessionKey = payload.sessionKey;\n      this.onReady();\n    } else if(payload.action === \"themes\") {\n      this.activateThemes(payload.data.themes);\n    }\n\n    else if(payload.original) {\n      // get callback from queue\n      var originalMessage = this.sentMessages.filter(function(message){\n        return message.messageId === payload.original.messageId;\n      })[0];\n\n      if(originalMessage.callback) {\n        originalMessage.callback(payload.data);\n      }\n    }\n  }\n\n  onReady() {\n    for(var message of this.messageQueue) {\n      this.postMessage(message.action, message.data, message.callback);\n    }\n    this.messageQueue = [];\n  }\n\n  postMessage(action, data, callback) {\n    if(!this.sessionKey) {\n      this.messageQueue.push({\n        action: action,\n        data: data,\n        callback: callback\n      });\n      return;\n    }\n\n    var message = {\n      action: action,\n      data: data,\n      messageId: this.generateUUID(),\n      sessionKey: this.sessionKey,\n      api: \"component\"\n    }\n\n    var sentMessage = JSON.parse(JSON.stringify(message));\n    sentMessage.callback = callback;\n    this.sentMessages.push(sentMessage);\n\n    window.parent.postMessage(message, '*');\n  }\n\n  setSize(type, width, height) {\n    this.postMessage(\"set-size\", {type: type, width: width, height: height}, function(data){\n\n    })\n  }\n\n  streamItems(callback) {\n    this.postMessage(\"stream-items\", {content_types: [\"Tag\"]}, function(data){\n      var tags = data.items;\n      callback(tags);\n    }.bind(this));\n  }\n\n  streamContextItem(callback) {\n    this.postMessage(\"stream-context-item\", null, function(data){\n      var item = data.item;\n      callback(item);\n    }.bind(this));\n  }\n\n  selectItem(item) {\n    this.postMessage(\"select-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  createItem(item) {\n    this.postMessage(\"create-item\", {item: this.jsonObjectForItem(item)}, function(data){\n      var item = data.item;\n      this.associateItem(item);\n    }.bind(this));\n  }\n\n  associateItem(item) {\n    this.postMessage(\"associate-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  deassociateItem(item) {\n    this.postMessage(\"deassociate-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  clearSelection() {\n    this.postMessage(\"clear-selection\", {content_type: \"Tag\"});\n  }\n\n  deleteItem(item) {\n    this.postMessage(\"delete-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n\n  saveItem(item) {\n    this.saveItems[item];\n  }\n\n  saveItems(items) {\n    items = items.map(function(item) {\n      return this.jsonObjectForItem(item);\n    }.bind(this));\n\n    this.postMessage(\"save-items\", {items: items}, function(data){\n\n    });\n  }\n\n  jsonObjectForItem(item) {\n    var copy = Object.assign({}, item);\n    copy.children = null;\n    copy.parent = null;\n    return copy;\n  }\n\n\n  /* Themes */\n\n  activateThemes(urls) {\n    this.deactivateAllCustomThemes();\n\n    console.log(\"Activiating themes\", urls);\n\n    if(!urls) {\n      return;\n    }\n\n    for(var url of urls) {\n      if(!url) {\n        continue;\n      }\n\n      var link = document.createElement(\"link\");\n      link.href = url;\n      link.type = \"text/css\";\n      link.rel = \"stylesheet\";\n      link.media = \"screen,print\";\n      link.className = \"custom-theme\";\n      document.getElementsByTagName(\"head\")[0].appendChild(link);\n    }\n  }\n\n  deactivateAllCustomThemes() {\n    var elements = document.getElementsByClassName(\"custom-theme\");\n\n    [].forEach.call(elements, function (element) {\n      if(element) {\n        element.disabled = true;\n        element.parentNode.removeChild(element);\n      }\n    });\n  }\n\n\n  /* Utilities */\n\n\n  generateUUID() {\n    var crypto = window.crypto || window.msCrypto;\n    if(crypto) {\n      var buf = new Uint32Array(4);\n      crypto.getRandomValues(buf);\n      var idx = -1;\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n          idx++;\n          var r = (buf[idx>>3] >> ((idx%8)*4))&15;\n          var v = c == 'x' ? r : (r&0x3|0x8);\n          return v.toString(16);\n      });\n    } else {\n      var d = new Date().getTime();\n      if(window.performance && typeof window.performance.now === \"function\"){\n        d += performance.now(); //use high-precision timer if available\n      }\n      var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = (d + Math.random()*16)%16 | 0;\n        d = Math.floor(d/16);\n        return (c=='x' ? r : (r&0x3|0x8)).toString(16);\n      });\n      return uuid;\n    }\n  }\n}\n\nwindow.ComponentManager = ComponentManager;\n"]}