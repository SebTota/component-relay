{"version":3,"sources":["../src/componentManager.js"],"names":["ComponentManager","permissions","onReady","sentMessages","messageQueue","loggingEnabled","onReadyCallback","coallesedSaving","coallesedSavingDelay","window","addEventListener","event","console","log","data","handleMessage","bind","payload","action","sessionKey","componentData","activateThemes","themes","original","originalMessage","filter","message","messageId","callback","postMessage","key","value","push","generateUUID","api","sentMessage","JSON","parse","stringify","parent","type","width","height","contentTypes","Array","isArray","content_types","items","streamedItems","filteredItems","item","localCopy","streamItems","candidate","uuid","updated_at","streamedContextItem","jsonObjectForItem","associateItem","content_type","deleteItems","params","map","saveItems","Date","saveBlock","pendingSave","clearTimeout","setTimeout","copy","Object","assign","children","urls","deactivateAllCustomThemes","url","link","document","createElement","href","rel","media","className","getElementsByTagName","appendChild","elements","getElementsByClassName","forEach","call","element","disabled","parentNode","removeChild","crypto","msCrypto","buf","Uint32Array","getRandomValues","idx","replace","c","r","v","toString","d","getTime","performance","now","Math","random","floor","module","exports"],"mappings":"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","file":"dist.js","sourcesContent":["class ComponentManager {\n\n  constructor(permissions, onReady) {\n    this.sentMessages = [];\n    this.messageQueue = [];\n    this.permissions = permissions;\n    this.loggingEnabled = false;\n    this.onReadyCallback = onReady;\n\n    this.coallesedSaving = true;\n    this.coallesedSavingDelay = 250;\n\n    window.addEventListener(\"message\", function(event){\n      if(this.loggingEnabled) {\n        console.log(\"Components API Message received:\", event.data);\n      }\n      this.handleMessage(event.data);\n    }.bind(this), false);\n  }\n\n  handleMessage(payload) {\n    if(payload.action === \"component-registered\") {\n      this.sessionKey = payload.sessionKey;\n      this.componentData = payload.componentData;\n      this.onReady();\n\n      if(this.loggingEnabled) {\n        console.log(\"Component successfully registered with payload:\", payload);\n      }\n\n    } else if(payload.action === \"themes\") {\n      this.activateThemes(payload.data.themes);\n    }\n\n    else if(payload.original) {\n      // get callback from queue\n      var originalMessage = this.sentMessages.filter(function(message){\n        return message.messageId === payload.original.messageId;\n      })[0];\n\n      if(originalMessage.callback) {\n        originalMessage.callback(payload.data);\n      }\n    }\n  }\n\n  onReady() {\n    for(var message of this.messageQueue) {\n      this.postMessage(message.action, message.data, message.callback);\n    }\n    this.messageQueue = [];\n\n    if(this.onReadyCallback) {\n      this.onReadyCallback();\n    }\n  }\n\n  setComponentDataValueForKey(key, value) {\n    this.componentData[key] = value;\n    this.postMessage(\"set-component-data\", {componentData: this.componentData}, function(data){});\n  }\n\n  clearComponentData() {\n    this.componentData = {};\n    this.postMessage(\"set-component-data\", {componentData: this.componentData}, function(data){});\n  }\n\n  componentDataValueForKey(key) {\n    return this.componentData[key];\n  }\n\n  postMessage(action, data, callback) {\n    if(!this.sessionKey) {\n      this.messageQueue.push({\n        action: action,\n        data: data,\n        callback: callback\n      });\n      return;\n    }\n\n    var message = {\n      action: action,\n      data: data,\n      messageId: this.generateUUID(),\n      sessionKey: this.sessionKey,\n      permissions: this.permissions,\n      api: \"component\"\n    }\n\n    var sentMessage = JSON.parse(JSON.stringify(message));\n    sentMessage.callback = callback;\n    this.sentMessages.push(sentMessage);\n\n    if(this.loggingEnabled) {\n      console.log(\"Posting message:\", message);\n    }\n\n    window.parent.postMessage(message, '*');\n  }\n\n  setSize(type, width, height) {\n    this.postMessage(\"set-size\", {type: type, width: width, height: height}, function(data){\n\n    })\n  }\n\n  streamItems(contentTypes, callback) {\n    if(!Array.isArray(contentTypes)) {\n      contentTypes = [contentTypes];\n    }\n    this.postMessage(\"stream-items\", {content_types: contentTypes}, function(data){\n      var items = data.items;\n      if(this.streamedItems) {\n        var filteredItems = items.filter((item) => {\n          var localCopy = this.streamItems.filter((candidate) => {return candidate.uuid == item.uuid });\n          // If a local copy doesn't exist, it's probably a new item, so we want to return it.\n          if(!localCopy) {\n            return true;\n          } else {\n            // The incoming timestamp should be greater than our last saved timestamp\n            return item.updated_at > localCopy.updated_at;\n          }\n        })\n        // All items should be saved, but only the filtered items should be sent back to the callback\n        this.streamItems = items;\n        callback(filteredItems);\n      } else {\n        this.streamItems = items;\n        callback(items);\n      }\n    }.bind(this));\n  }\n\n  streamContextItem(callback) {\n    this.postMessage(\"stream-context-item\", null, (data) => {\n      var item = data.item;\n      /*\n        When an item is saved via saveItem, its updated_at value is set client side to the current date.\n        If we make a change locally, then for whatever reason receive an item via streamItems/streamContextItem,\n        we want to ignore that change if it was made prior to the latest change we've made.\n      */\n      if(this.streamedContextItem && this.streamedContextItem.uuid == item.uuid && this.streamedContextItem.updated_at > item.updated_at) {\n        return;\n      }\n      this.streamedContextItem = item;\n      callback(item);\n    });\n  }\n\n  selectItem(item) {\n    this.postMessage(\"select-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  createItem(item, callback) {\n    this.postMessage(\"create-item\", {item: this.jsonObjectForItem(item)}, function(data){\n      var item = data.item;\n      this.associateItem(item);\n      callback && callback(item);\n    }.bind(this));\n  }\n\n  associateItem(item) {\n    this.postMessage(\"associate-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  deassociateItem(item) {\n    this.postMessage(\"deassociate-item\", {item: this.jsonObjectForItem(item)});\n  }\n\n  clearSelection() {\n    this.postMessage(\"clear-selection\", {content_type: \"Tag\"});\n  }\n\n  deleteItem(item) {\n    this.deleteItems([item]);\n  }\n\n  deleteItems(items) {\n    var params = {\n      items: items.map(function(item){\n        return this.jsonObjectForItem(item);\n      }.bind(this))\n    };\n    this.postMessage(\"delete-items\", params);\n  }\n\n  sendCustomEvent(action, data, callback) {\n    this.postMessage(action, data, function(data){\n      callback && callback(data);\n    }.bind(this));\n  }\n\n  saveItem(item) {\n    this.saveItems([item]);\n  }\n\n  saveItems(items) {\n    items = items.map(function(item) {\n      item.updated_at = new Date();\n      return this.jsonObjectForItem(item);\n    }.bind(this));\n\n    let saveBlock = () => {\n      this.postMessage(\"save-items\", {items: items}, function(data){\n\n      });\n    }\n\n    /*\n        Coallesed saving prevents saves from being made after every keystroke, and instead\n        waits coallesedSavingDelay before performing action. For example, if a user types a keystroke, and the clienet calls saveItem,\n        a 250ms delay will begin. If they type another keystroke within 250ms, the previously pending\n        save will be cancelled, and another 250ms delay occurs. If ater 250ms the pending delay is not cleared by a future call,\n        the save will finally trigger.\n\n        Note: it's important to modify saving items updated_at immediately and not after delay. If you modify after delay,\n        a delayed sync could just be wrapping up, and will send back old data and replace what the user has typed.\n    */\n    if(this.coallesedSaving == true) {\n      if(this.pendingSave) {\n        clearTimeout(this.pendingSave);\n      }\n\n      this.pendingSave = setTimeout(() => {\n        saveBlock();\n      }, this.coallesedSavingDelay);\n    }\n  }\n\n  jsonObjectForItem(item) {\n    var copy = Object.assign({}, item);\n    copy.children = null;\n    copy.parent = null;\n    return copy;\n  }\n\n\n  /* Themes */\n\n  activateThemes(urls) {\n    this.deactivateAllCustomThemes();\n\n    if(this.loggingEnabled) {\n      console.log(\"Activating themes:\", urls);\n    }\n\n    if(!urls) {\n      return;\n    }\n\n    for(var url of urls) {\n      if(!url) {\n        continue;\n      }\n\n      var link = document.createElement(\"link\");\n      link.href = url;\n      link.type = \"text/css\";\n      link.rel = \"stylesheet\";\n      link.media = \"screen,print\";\n      link.className = \"custom-theme\";\n      document.getElementsByTagName(\"head\")[0].appendChild(link);\n    }\n  }\n\n  deactivateAllCustomThemes() {\n    var elements = document.getElementsByClassName(\"custom-theme\");\n\n    [].forEach.call(elements, function (element) {\n      if(element) {\n        element.disabled = true;\n        element.parentNode.removeChild(element);\n      }\n    });\n  }\n\n\n  /* Utilities */\n\n\n  generateUUID() {\n    var crypto = window.crypto || window.msCrypto;\n    if(crypto) {\n      var buf = new Uint32Array(4);\n      crypto.getRandomValues(buf);\n      var idx = -1;\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n          idx++;\n          var r = (buf[idx>>3] >> ((idx%8)*4))&15;\n          var v = c == 'x' ? r : (r&0x3|0x8);\n          return v.toString(16);\n      });\n    } else {\n      var d = new Date().getTime();\n      if(window.performance && typeof window.performance.now === \"function\"){\n        d += performance.now(); //use high-precision timer if available\n      }\n      var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = (d + Math.random()*16)%16 | 0;\n        d = Math.floor(d/16);\n        return (c=='x' ? r : (r&0x3|0x8)).toString(16);\n      });\n      return uuid;\n    }\n  }\n}\n\n\nif(typeof module != \"undefined\" && typeof module.exports != \"undefined\") {\n  module.exports = ComponentManager;\n}\n\nif(window) {\n  window.ComponentManager = ComponentManager;\n}\n"]}